# pgBackRest Configuration - Generated by Ansible
# Datacenter: {{ dc_name | default('N/A') }}
# Role: {{ pg_role | default('unknown') }}

[global]
# Repository configuration
repo1-path={{ pgbackrest_repo_path }}
repo1-retention-full={{ backup_retention_full }}
repo1-retention-diff={{ backup_retention_diff }}

# Compression settings
compress-type={{ backup_compress_type }}
compress-level={{ backup_compress_level }}

# Process settings
process-max={{ backup_process_max }}

# Logging
log-level-console=info
log-level-file=detail
log-path={{ pgbackrest_log_path }}

# Spool path for async operations
spool-path={{ pgbackrest_spool_path }}

# Archive settings
archive-async=y
archive-push-queue-max=4GiB

{% if pg_role == 'primary' and backup_ship_to_standby %}
# Remote repository on standby site
repo2-host={{ backup_standby_host }}
repo2-host-user={{ backup_standby_user }}
repo2-path={{ pgbackrest_repo_path }}
repo2-retention-full={{ backup_retention_full * 2 }}
repo2-retention-diff={{ backup_retention_diff * 2 }}
{% endif %}

[{{ pgbackrest_stanza }}]
# PostgreSQL settings
pg1-path=/var/lib/postgresql/data/pgdata
pg1-port={{ postgresql.port | default(5432) }}

{% if pg_role == 'primary' %}
# Primary specific settings
pg1-host-type=tls
archive-check=y
{% else %}
# Standby specific settings
recovery-option=standby_mode=on
recovery-option=primary_conninfo={{ pg_primary_conninfo | default('') }}
{% endif %}

# Backup settings
start-fast=y
stop-auto=y
delta=y

# Verification
checksum-page=y
